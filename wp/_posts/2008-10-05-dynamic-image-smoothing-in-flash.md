---
title: Глянцевые черты фотографий во флеше
author: Genn
layout: post
permalink: /2008/dynamic-image-smoothing-in-flash/
tags:
  - adobe
  - flash
  - gui
---
<img src="http://mega.genn.org/=^_^=/uploads/2008/10/mini.jpg" alt="Mini watermark" width="460" height="285" />

Неаккуратно сделанный флеш-ролик всегда можно узнать по присущим только флешу «водяным знакам качества»: возможности выделить мышкой текст на кнопках и отчаянному пикселению невекторных объектов. Порой, конечно, приходится ухудшать качество, чтобы не сильно грузить процессор, но это не то, о чем я говорю. Речь о свойстве *Allow smoothing* у находящихся в *Library* растровых изображений. Что же делать, когда эти изображения не в библиотеке символов?  
<!--more-->

  
<img src="http://mega.genn.org/=^_^=/uploads/2008/10/allow.jpg" alt="Allow smoothing" width="460" height="308"" />

<p class="imgdesc">
  С включенным свойством «Allow smoothing» (пункт «Properties…» контекстного меню растрового объекта в библиотеке) фотографии всегда будут выглядеть дружелюбно (одно из значений слова «smooth»)
</p>

## Неожиданные преграды и их нетрадиционное преодоление

В субботу утром я решил помочь американским товарищам с сайтом, на котором представлены красивые фотографии красивых машинок. Специфика представления фотографий подразумевала изменение их размера в зависимости от размера окна броузера. Ничего особенного, если не считать, что вплоть до восьмой версии флеша Macromedia, а нычне Adobe, их авторы так и не удосужились дать возможность allow smoothing для динамически подгружаемых растровых изображений.



<p class="imgdesc">
  Достаточно навести курсор на изображение Mini, чтобы увидеть, как плохо выглядят растровые изображения с измененными начальными параметрами (угол наклона, размер) без сглаживания во флеше
</p>

<p style="margin-left: 10px; padding-left: 30px; border-left: 3px solid #005bcd;">
  <i>Update (спасибо, Женя)</i><br />Начиная с девятой версии флеша есть свойство <i>movieClip.forceSmoothing</i>. Когда оно равно <i>true</i>, изображение изменяет свой размер со сглаживанием. Дальнейший текст не убираю для истории и флеша младше девятой версии, но проблема решается куда проще: <i>movieClip.forceSmoothing=true</i>.
</p>

Несмотря на отсутствие легких путей решения проблемы в Flash 8 и младше, как это часто бывает с флешем, нашелся не самый сложный обходной путь. Подгружаем фотографию, после чего создаем объект *BitmapData*, куда и переводим загруженное изображение. Оказывается, ничего не стоит включить сглаживание при этой процедуре. После того, как изображение загружено, а сглаживание включено, «отрисовываем» изображение.

<ol class="h4x0r">
  <li>
    <code>import flash.display.*; &lt;i>// подгружаем необходимую для работы с BitmapData библиотеку&lt;/i></code>
  </li>
  <li>
    <code>_root.createEmptyMovieClip("pic",_root.getNextHighestDepth()); &lt;i>// сюда поместим картинку со сглаживанием&lt;/i></code>
  </li>
  <li>
    <code>_root.createEmptyMovieClip("tmpic",_root.getNextHighestDepth()); &lt;i>// в этот символ загрузим jpeg&lt;/i></code>
  </li>
  <li>
    <code>_root.tmpic._visible=false;</code>
  </li>
  <li>
    <code>… &lt;i>// опускаем код прелоадера, файл загружается в _root.tmpic&lt;/i></code>
  </li>
  <li>
    <code>… &lt;i>// дальнейший код выполняется после завершения загрузки изображения&lt;/i></code>
  </li>
  <li>
    <code>var bitmap:BitmapData = new BitmapData(</code>
  </li>
  <li>
    <code style="padding-left: 3em;">_root.tmpic._width,</code>
  </li>
  <li>
    <code style="padding-left: 3em;">_root.tmpic._height,</code>
  </li>
  <li>
    <code style="padding-left: 3em;">true);</code>
  </li>
  <li>
    <code></code>
  </li>
  <li>
    <code>_root.pic.attachBitmap(</code>
  </li>
  <li>
    <code style="padding-left: 3em;">bitmap,</code>
  </li>
  <li>
    <code style="padding-left: 3em;">_root.pic.getNextHighestDepth(),</code>
  </li>
  <li>
    <code style="padding-left: 3em;">"auto",</code>
  </li>
  <li>
    <code style="padding-left: 3em;">true); &lt;i>// этот параметр включает сглаживание&lt;/i></code>
  </li>
  <li>
    <code></code>
  </li>
  <li>
    <code>bitmap.draw(_root.tmpic); &lt;i>// переносим фотографию на холст ;)&lt;/i></code>
  </li>
</ol>

Пример рабочий, проверено на себе. Поскольку я никак не могу заставить себя полностью перебраться на AS3, программный код написан для Action Script 2, да и требования к сайту вынуждали пользоваться именно этой версией. Но настанет тот час, и я чувствую, что очень скоро, когда я буду вынужден портировать этот код, и не только его, на Action Script 3 или даже выше ;)

## \***

Я уверен, что не открыл революционный способ (поиск по интернету показал, что я не один такой умный). Тем не менее, уверен, что это простое решение наверняка будет полезным, ведь вопросы об этом мне задают с завидной регулярностью. 

Из того же поиска по интернету стало известно, что предложенный выше способ не будет работать, если подгружать изображения с других доменов. Вроде бы есть решения и для этой проблемы, но все они, насколько я заметил, сводятся к совету сделать свой прокси и грузить изображения через него. В это же время [flickr подружился с флешем][1], так что писать интерфейсы для работы с фотографиями с этого ресурса уже не составит труда.

Хочется верить, что в ожидаемом и анонсируемом [Flash CS4][2] встроят не только поддержку 3d (да-да, там будет какой-то псевдо-трехмерный инструментарий), но и кучу недостающих мелочей. Таких как, например, dynamic image smoothing, который появился в Flash CS3.

 [1]: http://www.yswfblog.com/blog/2007/08/29/flickr-now-even-more-flash-friendly/
 [2]: http://www.adobe.com/products/flash/